# 实况限制时长方案

## 背景
当前实况播放**转发**及**分发**都涉及流量费用，无限制播放导致高额流量费用，普通p2p长时间实况播放也会对带宽及设备有一定程度的影响

## 此方案要做的
根据服务器配置参数，对正在播放的视频进行限制，比如用户在一定时间内不操作手机，对视频进行停流

## 需要考虑的点
>-  如何获取限制参数？
>-  如何判断时间阈值内用户没有操作？
>-  停流前30秒给出提示，如何提示？
>-  停流后窗格上如何提升？
>-  停流后用户点击重新起流的操作？

## 方案流程
### 整体流程
 1.  从服务器上获取配置(时间阈值，允许播放的时间)；
 2.  实况界面起流开始计时（全局只计一份），超过时间阈值如果用户没有操作，则对转发/分发的窗格进行停流，并在窗格上做出提示；

### 具体流程
下面具体分析每步流程

#### 1、配置获取（云配置本地缓存）
- 启动app时获取服务器AppCfg.json上播放时间阈值，如过未获取成功，使用默认配置（10min）
- 获取成功后保存至本地，下次启动的时候如果没获取到用作默认值。

#### 2、实况限制
- 起流后开始计时，在阈值前30s如果用户未进行操作，则给用户进行全局提示**（需UI设计样式，资料确认提示语）**，“长时间未进行操作，窗格将停流，如要继续，请点击屏幕”，如果30s内用户进行操作，则重置定时器，如用户未操作，则进行接下来的停流操作；
- 如果在**阈值范围内用户未进行操作**，则遍历所有正在播放放的窗格，对正在播放的窗格进行停流，并给出提示（提示需资料确认提示语），“长时间未操作，窗格实况已停止，点击继续播放”；

#### 3、恢复播放
- 停止播放以后，如果用户点击窗格重新起流（之前超过限制停止播放的窗格），则对之前停止的所有窗格进行重新起流播放。
  
## 涉及模块
>-  多语言（限制前提示，限制后提示）--资料，交互，app
>-  实况模块（播放限制）--app

## 交互工作量
- 提示弹框形式及样式
- 
## 资料工作量
限制前30秒提示，限制后停流提示

## 工作量评估
>  Android：？人天
>  iOS ：？人天
